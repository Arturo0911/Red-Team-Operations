#!/usr/bin/python3


@app.route('/escalate', methods=['GET','POST'])
@login_required
def escalate():
    if request.method=='GET':
        conn.reconnect()
        c = conn.cursor()
        c.execute('select * from tickets')
        r = c.fetchall()
        return render_template('escalate.html',tickets=r)
    else:
        to = request.form.get('to')
        link = request.form.get('link')
        issue = request.form.get('issue')
        reason = request.form.get('reason')
        if 'http' in link.lower():
            ip = link.split('/')[2]
            tun_ip = ni.ifaddresses('eth0')[ni.AF_INET][0]['addr']
            if ip!=tun_ip:
                return 'This request can\'t be reviewed since the issue link is flagged'
            conn.reconnect()
            c = conn.cursor()
            c.execute('insert into escalate values(%s,%s,%s,%s)',(to,issue,link,reason,))
            conn.commit()
            return 'Escalation form submitted to Admin and will be reviewed soon!'
