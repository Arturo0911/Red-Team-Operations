# Cron Job Abuse

Cron jobs can also be set run one tome (such as on boot). They are typically used for
administrative tasks such as running backups, cleaning up directories, etc. The
crontab comand can create ca cron file, which will be run by the cron daemon on the 
schedule specified. When created, the cron dile will be created in ```/var/spool/cron```
for the scpecific user that creates it. Each entry in the crontab file requires six items
in the following order: minutes, hours, days, months, weeks, commands. For example, the
entry 0 */12 * * * /home/admin/backup.sh would run every 12 hours.

The root crontab is almost always only editable by the root user or a suer with full sudo
priviletges; however, it can still be abused. You may find a world-writeable script that runs
as root and, even if you cannot read the crontab to know the exact scredule, you may be 
avle to ascertain how often it runs (i.e., a backup script taht created a .tar.gz file
every 12 hours). In this case, you can append a command onto the end of the script (such
as a reverse shell one-liner), and it will execute the nex time the cron job runs.

Certain applications create cron files in the ```/etc/cron.d``` directory and may be
misconfigured to allow a non-root user to edit them.

Firs, let's look around the system for any writeable files or directories. The file
```backup.sh``` in the ```/dmz-backups``` directory is interesting and seems like it could
be running on a cron job.

```
find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null

# output
#

/etc/cron.daily/backup
/dmz-backups/backup.sh
/proc
/sys/fs/cgroup/memory/init.scope/cgroup.event_control

<SNIP>
/home/backupsvc/backup.sh

<SNIP>

```

A quick look in the ```/dmz/backups``` directory show swhat appears to be files created
every three minutes. This seems to be a major misconfiguration. Perhaps the sysadmin
mean to specify every three hours like ```0 */3 * * *``` but instead wrote ```*/3 * * * *```, which tells the cron job to run every three minutes. the second issue is that the
backup.sh shell script is wordl writeable and runs as root.

```
0xevilpayload@htb[/htb]$ ls -la /dmz-backups/

total 36
drwxrwxrwx  2 root root 4096 Aug 31 02:39 .
drwxr-xr-x 24 root root 4096 Aug 31 02:24 ..
-rwxrwxrwx  1 root root  230 Aug 31 02:39 backup.sh
-rw-r--r--  1 root root 3336 Aug 31 02:24 www-backup-2020831-02:24:01.tgz
-rw-r--r--  1 root root 3336 Aug 31 02:27 www-backup-2020831-02:27:01.tgz
-rw-r--r--  1 root root 3336 Aug 31 02:30 www-backup-2020831-02:30:01.tgz
-rw-r--r--  1 root root 3336 Aug 31 02:33 www-backup-2020831-02:33:01.tgz
-rw-r--r--  1 root root 3336 Aug 31 02:36 www-backup-2020831-02:36:01.tgz
-rw-r--r--  1 root root 3336 Aug 31 02:39 www-backup-2020831-02:39:01.tgz
```

We can confirm that a cron job is running using pspy, a command-line tool used to view
running processes without the need for root privileges. We can use it to see commands
run by other users, cron, jobs, etc. It works by scanning procfs

Let's run pspy and have a look. the -pf flag tells the tool to print commands and file
system events and -i 1000 tells it to scan profcs every 1000ms (or every second)
