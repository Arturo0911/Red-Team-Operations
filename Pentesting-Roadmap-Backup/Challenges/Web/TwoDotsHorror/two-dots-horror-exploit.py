#!/usr/bin/python3


from pprint import pprint
import requests
import sys
from pwn import *


def run_exploit(url):

    # to create a new user
    # while True:
    login_ress = requests.post(url=url+"api/login", json={
        "username":"guest1",
        "password":"guest1"
    })
    if login_ress.status_code != 200:
        log.success("user registered successfully...")
        ress = requests.post(url=url+"api/register", json={
            "username":"guest1",
            "password":"guest1"
        })


    log.info("Starting with the login")
    login_ress = requests.post(url=url+"api/login", json={
        "username":"guest1",
        "password":"guest1"
        })
    # setting the headers and the cookie session
    headers = login_ress.headers
    cookie_session = login_ress.cookies.get_dict()
    api_submit = requests.post(url=url+"api/submit", json={
        "content":"hola soy arturo como estas.."
        }, cookies=cookie_session)
    # to see if there are any cookie setted
    pprint(requests.get(url=url).headers)
    if api_submit.status_code != 200:
        print(api_submit.json())
    else:
        print(api_submit.json())




            
def main():

    try:
        target_url = sys.argv[1]
        run_exploit(target_url)

    except Exception as e:
        raise Exception
        print(str(e))
        exit(1)

    except KeyboardInterrupt:
        exit(0)



if __name__ == "__main__":
    main()
